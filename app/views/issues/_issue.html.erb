<article class="issue issue-<%= issue.status.to_s.sub(" ", "_") %>">
  <p class="actions" id="issue-actions-<%= issue.id %>">
    <!-- TODO: Action helper -->
    <% if issue.status == "pending" or issue.status == "revalidated" %>
      <%= link_to "I want to solve this!", solve_issue_path(issue), :class => "btn btn-large btn-success", :remote => true %>
    <% end %>
    <% if issue.status == "waiting for validation" and issue.who_is_solving != current_user %>
      <%= link_to "Validate", validate_issue_path(issue), :class => "btn btn-large btn-warning", :remote => true %>
    <% end %>
    <% if issue.status == "in progress" and issue.who_is_solving == current_user.id %>
      <%= link_to "Done!", done_solving_path(issue), :class => "btn btn-large btn-success", :remote => true %>
    <% end %>
  </p>
  <p class="content">
    <%= issue.content %> 
    <span class="label label-<%= issue.status.to_s.sub(" ", "_") %>"><%= issue.status %></span>
    <% if issue.tags.any? %>
      <% issue.tags.each do |tag| %>
        <span class="label label-warning"><%= link_to tag.name, "#" %></span>
      <% end %>
    <% end %>
    <% if not @project %><span class="label"><%= link_to issue.project.name, issue.project %></span><% end %>
  </p>
  <p class="author"><strong><%= t("issues.author") %></strong> <span class="label"><%= link_to issue.user.name, issue.user %></span></p>
  
  <% if issue.comment_threads.any? %>
    <section class="comentarios">
      <% issue.comment_threads.each do |comment| %>
        <article>
          <p><%= comment.body %></p>
          <p class="author">By <%= link_to comment.user.name, comment.user %>, <%= time_ago_in_words(comment.created_at) %> ago</p>
        </article>
      <% end %>
    </section>
  <% end %>
  
  <%= render :partial => "comments/form", :locals => {:issue => issue} %>

</article>